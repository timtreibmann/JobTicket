<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head></h:head>
<h:body>
	<h:form>
		<p:breadCrumb>
			<p:menuitem value="Übersicht"
				url="http://localhost:8080/JobTicket/faces/start.xhtml" />
			<p:menuitem value="Jobticket"
				url="http://localhost:8080/JobTicket/faces/jobticket_main.xhtml" />
			<p:menuitem value="Aufwand festlegen"
				url="http://localhost:8080/JobTicket/faces/jobticket_aufwand.xhtml" />
		</p:breadCrumb>

		<h:panelGrid columns="2">
			<p:panel id="panel" header="Aufwand für #{jobticketBean.job.name}">
				<p:button value="Zurück" outcome="jobticket_produktbeschreibung"></p:button>
				<p:button value="Fertig" outcome="start.xhtml"></p:button>
				<h:panelGrid columns="1">
					<h:panelGrid columns="2">
						<h:inputHidden value="#{aufwandBean.kosten.id}"></h:inputHidden>
						<h:inputHidden></h:inputHidden>
						<p:fieldset>
							<h:panelGrid columns="3">
								<p:outputLabel for="kontakter" value="Angestellter" />
								<p:selectOneMenu id="kontakter"
									value="#{aufwandBean.selectedAngestellteId}" effect="fold"
									editable="false" required="true">
									<f:selectItems value="#{angestellteBean.angestelltes}"
										var="angestellte" itemLabel="#{angestellte.vorname}"
										itemValue="#{angestellte.id}" />
									<p:ajax event="change" update="@form"
										listener="#{aufwandBean.selectedAngestellteId}" />
								</p:selectOneMenu>
							</h:panelGrid>

							<p:commandButton value="Angestellten zum Job hinzufügen"
								update="@form" actionListener="#{aufwandBean.saveKosten}" />

							<p:button id="neuerAngestellterButton"
								value="neuen Angestellten anlegen" icon="ui-icon-plus"
								outcome="angestellte_add.xhtml" type="button"
								title="neuer Kunde">
							</p:button>
						</p:fieldset>
						<p></p>
						<p:fieldset>
							<p:outputLabel value="Am Job arbeitende Angestellte:"></p:outputLabel>
							<ui:repeat var="kosten" value="#{aufwandBean.kostenFromJob}">
								<p:panel>
									<p:growl id="growl"></p:growl>
									<p:commandButton ajax="false"
										action="#{aufwandBean.delete(kosten)}" icon="ui-icon-trash"></p:commandButton>

									<h:outputLabel value="Name: #{kosten.angestellte.vorname} "></h:outputLabel>
									<h:outputLabel value="#{kosten.angestellte.nachname}"></h:outputLabel>
									<h:panelGrid columns="3">

										<p:inputText id="aufwand" value="#{kosten.arbeitsaufwand}">
											<f:convertNumber pattern="#0.00"></f:convertNumber>
											<p:ajax event="change" process="@this" update="@form"
												listener="#{aufwandBean.updateKosten(kosten)}"></p:ajax>
										</p:inputText>
										<p:commandButton update="@this aufwand" process="aufwand"
											value=" #{kosten.arbeitsaufwandIstInEuro==1 ? '€':'Stunden' }"
											actionListener="#{aufwandBean.rechneUm(kosten)}"></p:commandButton>
									</h:panelGrid>
								</p:panel>
							</ui:repeat>
							<p:outputLabel value="Gesamtkosten: "></p:outputLabel>
							<p:inputText disabled="true" id="gesamtkosten"
								value="#{aufwandBean.gesamtKosten}">
								<f:convertNumber pattern="#0.00"></f:convertNumber>
							</p:inputText>
						</p:fieldset>
					</h:panelGrid>
					<h:panelGrid columns="2">
						<p:button icon="ui-icon-alert" title="Achtung">
							<f:param name="achtung" />
						</p:button>
						<h:panelGrid columns="3">
							<p:outputLabel value="Budget" />
							<p:inputText value="#{jobticketBean.job.budgetInEuro} €"
								disabled="true" />
						</h:panelGrid>
					</h:panelGrid>
				</h:panelGrid>

			</p:panel>


		</h:panelGrid>
	</h:form>
</h:body>
</html>